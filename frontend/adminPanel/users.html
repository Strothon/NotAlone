<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Subscribers</title>
    <link rel="stylesheet" href="users.css"> <!-- CSS dosyasını bağla -->
    <link href="https://cdn.jsdelivr.net/npm/boxicons@2.1.4/css/boxicons.min.css" rel="stylesheet">
    <script src="https://kit.fontawesome.com/581952776c.js" crossorigin="anonymous"></script>
</head>
<body>

    <!-- Sidebar -->
    <div class="sidebar">
        <div class="title">
            <p>Dashboard</p>
        </div>
        <div class="icons">
            <ul>
                <li><a href="../adminPanel/adminPanel.html"><i class='bx bx-home-circle'></i><span>Home</span></a></li>
                <li><a href="../adminPanel/users.html"><i class='bx bx-user'></i><span>Users</span></a></li>
                <li><a href="../adminPanel/messages.html"><i class='bx bx-comment'></i><span>Messages</span></a></li>
                <li><a href="../adminPanel/posts.html"><i class='bx bx-message-square-detail'></i><span>Posts</span></a></li>
                <li><a href="../adminPanel/stories.html"><i class='bx bx-message-square-detail'></i><span>Stories</span></a></li>
                <li><a href="../adminPanel/blockedusers.html"><i class='bx bx-block'></i><span>Blocked Users</span></a></li>
                <!-- <li><a href="../adminPanel/settings.html"><i class='bx bx-cog'></i><span>Settings</span></a></li>-->
              </ul>
        </div>
    </div>

    <div class="table-container">
        <div class="table-options">
            <input type="text" id="search" placeholder="Search..." class="search-box">
            <select id="sort-options" class="sort-select">
                <option value="newest">Newest</option>
                <option value="oldest">Oldest</option>
            </select>
        </div>
        
        
        <table>
            <thead>
                <tr>
                    <th>First Name</th>
                    <th>Last Name</th>
                    <th>Username</th>
                    <th>Email</th>
                    <th>Phone</th>
                    <th>Join Date</th>
                    <th>Actions</th> <!-- Yeni sütun -->
                </tr>
            </thead>
            <tbody id="user-table-body">
                <!-- Kullanıcı satırları buraya eklenecek -->
            </tbody>
        </table>
    </div>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const searchInput = document.getElementById('search');
            const sortSelect = document.getElementById('sort-options');
            const tableBody = document.getElementById('user-table-body');
    
            // Fetch users from API
            async function fetchUsers() {
                try {
                    const response = await fetch('/api/users');
                    const users = await response.json();
                    populateTable(users);
                    sortTable(); // Initial sort
                } catch (error) {
                    console.error('Error fetching users:', error);
                }
            }
    
            // Populate table with user data
            function populateTable(users) {
                tableBody.innerHTML = ''; // Clear existing rows
                users.forEach(user => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${user.firstName}</td>
                        <td>${user.lastName}</td>
                        <td>${user.email.split('@')[0]}</td> <!-- Use email prefix as username -->
                        <td>${user.email}</td>
                        <td>${user.phone || 'N/A'}</td>
                        <td>${user.joinDate}</td>
                        <td>
                            <button class="action-btn block-btn">
                                <i class="fa-solid fa-ban"></i>
                                <span class="tooltip">Block</span>
                            </button>
                            <button class="action-btn view-btn">
                                <i class="fa-regular fa-eye"></i>
                                <span class="tooltip">View</span>
                            </button>
                        </td>
                    `;
                    tableBody.appendChild(row);
                });
            }
    
            // Filter function (same as before)
            function filterTable() {
                const searchTerm = searchInput.value.toLowerCase();
                const rows = tableBody.querySelectorAll('tr');
    
                rows.forEach(row => {
                    const cells = row.querySelectorAll('td');
                    let match = false;
    
                    cells.forEach(cell => {
                        if (cell.textContent.toLowerCase().includes(searchTerm)) {
                            match = true;
                        }
                    });
    
                    row.style.display = match ? '' : 'none';
                });
            }
    
            // Sort function (modified to work with dynamic data)
            function sortTable() {
                const rowsArray = Array.from(tableBody.querySelectorAll('tr'));
                const sortOption = sortSelect.value;
    
                rowsArray.sort((a, b) => {
                    const dateA = parseDate(a.cells[5].textContent);
                    const dateB = parseDate(b.cells[5].textContent);
                    return sortOption === 'newest' ? dateB - dateA : dateA - dateB;
                });
    
                rowsArray.forEach(row => tableBody.appendChild(row));
            }
    
            // Helper function to parse DD-MM-YYYY dates
            function parseDate(dateString) {
                const [day, month, year] = dateString.split('-');
                return new Date(year, month - 1, day);
            }
    
            // Event listeners
            searchInput.addEventListener('input', filterTable);
            sortSelect.addEventListener('change', sortTable);
    
            // Initial fetch
            fetchUsers();
        });
    </script>
</body>
</html>